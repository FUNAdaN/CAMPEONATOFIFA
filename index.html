<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FC25 Guri Pro - Elite Realtime</title>
    <style>
        :root { --gold: #f3ad0e; --dark: #05070a; --panel: #11151f; --accent: #1e2533; --green: #27ae60; --red: #e74c3c; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        .tabs { display: flex; gap: 5px; width: 100%; max-width: 600px; position: sticky; top: 0; z-index: 100; background: var(--dark); padding: 10px 0; }
        .tab-btn { background: var(--panel); color: #888; border: 1px solid #333; padding: 12px 5px; cursor: pointer; border-radius: 8px; font-weight: bold; font-size: 0.7em; flex: 1; text-align: center; }
        .tab-btn.active { background: var(--gold); color: black; border-color: var(--gold); }

        .content-section { display: none; width: 100%; max-width: 600px; flex-direction: column; align-items: center; }
        .content-section.active { display: flex; }

        .card { background: var(--panel); border-radius: 12px; width: 100%; border: 1px solid #333; margin-bottom: 20px; padding: 15px; }
        .table-wrapper { width: 100%; overflow-x: auto; border-radius: 10px; border: 1px solid #333; margin-bottom: 20px;}
        table { border-collapse: collapse; width: 100%; background: #0d1117; }
        th, td { padding: 12px 5px; text-align: center; border-bottom: 1px solid #222; font-size: 0.75em; }
        th { background: var(--accent); color: var(--gold); text-transform: uppercase; }
        
        .logo-img { width: 20px; height: 20px; object-fit: contain; vertical-align: middle; }
        .logo-mata { width: 35px; height: 35px; object-fit: contain; }
        .score-input { width: 45px !important; height: 38px; text-align: center; color: var(--gold); font-weight: bold; font-size: 1.1em; background: #000; border: 1px solid #444; border-radius: 6px; }
        
        .jogos-grid { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .jogo { background: var(--panel); padding: 12px; border-radius: 12px; border: 1px solid #333; margin-bottom: 10px; }
        .match-row { display: flex; align-items: center; justify-content: space-between; gap: 5px; }
        .team-display { flex: 1; display: flex; align-items: center; font-size: 0.85em; font-weight: bold; gap: 8px; overflow: hidden; }
        .flex-end { justify-content: flex-end; text-align: right; }

        .fase-titulo { color: var(--gold); text-align: center; font-size: 0.9em; margin: 25px 0 10px 0; text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid #333; padding-bottom: 5px; width: 100%; font-weight: bold;}
        .btn-ok { background: var(--green); border: none; color: white; padding: 10px; border-radius: 6px; width: 100%; font-weight: bold; margin-top: 8px; cursor: pointer; text-transform: uppercase; font-size: 0.75em; }
        .btn-danger { background: var(--red); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 20px; }
        
        .config-row { display: grid; grid-template-columns: 1fr 1.5fr; gap: 8px; margin-bottom: 10px; }
        input, select { background: #000; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; width: 100%; }
    </style>
</head>
<body>

    <div class="tabs">
        <button class="tab-btn active" id="btn-aba-grupo" onclick="window.openTab('aba-grupo')">CLASSIFICA√á√ÉO</button>
        <button class="tab-btn" id="btn-aba-matamata" onclick="window.openTab('aba-matamata')">MATA-MATA</button>
        <button class="tab-btn" id="btn-aba-hall" onclick="window.openTab('aba-hall')">üéñÔ∏è</button>
        <button class="tab-btn" id="btn-aba-config" onclick="window.openTab('aba-config')">‚öôÔ∏è</button>
    </div>

    <div id="aba-grupo" class="content-section active">
        <div class="table-wrapper">
            <table>
                <thead><tr><th>Pos</th><th style="text-align:left; padding-left:10px;">Guri</th><th>P</th><th>J</th><th>V</th><th>SG</th></tr></thead>
                <tbody id="corpo-tabela"></tbody>
            </table>
        </div>
        <div class="jogos-grid" id="container-jogos"></div>
    </div>

    <div id="aba-matamata" class="content-section">
        <div id="mata-mata-container" style="width: 100%;"></div>
    </div>

    <div id="aba-hall" class="content-section"><div class="card" id="lista-hall"></div></div>

    <div id="aba-config" class="content-section">
        <div class="card">
            <h3 style="text-align: center; color: var(--gold);">NOVO CAMPEONATO</h3>
            <select id="qtd-times" onchange="window.renderCamposConfig()"></select>
            <div id="lista-config" style="margin-top:15px"></div>
            <button class="btn-danger" id="btn-iniciar">üî• RESETAR TUDO E INICIAR</button>
        </div>
    </div>

    <div id="aba-vencedor" class="content-section">
        <div style="text-align:center; padding:60px 20px; border:4px solid var(--gold); border-radius:20px; background:#000; width:100%">
            <div id="img-vencedor"></div>
            <h1 id="nome-campeao" style="color:var(--gold); font-size:2.5em; margin:10px 0;">---</h1>
            <p style="letter-spacing:3px">üèÜ CAMPE√ÉO FC25 üèÜ</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // CONFIGURA√á√ÉO DO FIREBASE (MANTENHA A SUA)
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            databaseURL: "https://torneiodosguri-default-rtdb.firebaseio.com",
            projectId: "torneiodosguri"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const timesFC25 = { "Real Madrid": "541", "Man. City": "50", "Liverpool": "40", "Barcelona": "529", "Bayern": "157", "Arsenal": "42", "Inter": "505", "Leverkusen": "168", "PSG": "85", "Atl√©tico": "530", "Dortmund": "165", "Juventus": "496", "Milan": "489", "Chelsea": "49", "Benfica": "190", "Porto": "192", "Napoli": "492", "Roma": "497", "Aston Villa": "66", "Tottenham": "47", "Fran√ßa": "2", "Argentina": "26", "Inglaterra": "10", "Espanha": "5", "Portugal": "27", "Alemanha": "9", "Brasil": "6" };
        
        let localData = { duplas: [], placares: {}, ordemJogos: [] };

        window.openTab = (id) => {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-' + id).classList.add('active');
        };

        const selQtd = document.getElementById('qtd-times');
        for(let i=2; i<=20; i++) {
            let opt = document.createElement('option'); opt.value = i; opt.text = i + " Participantes";
            if(i === 8) opt.selected = true;
            selQtd.appendChild(opt);
        }

        window.renderCamposConfig = () => {
            const qtd = parseInt(selQtd.value);
            const container = document.getElementById('lista-config');
            container.innerHTML = "";
            for(let i=0; i<qtd; i++) {
                container.innerHTML += `<div class="config-row"><input type="text" id="nome-${i}" placeholder="Guri ${i+1}"><select id="time-${i}">${Object.keys(timesFC25).sort().map(t => `<option value="${t}">${t}</option>`).join('')}</select></div>`;
            }
        };
        window.renderCamposConfig();

        // Gerar ordem aleat√≥ria sem repeti√ß√£o seguida
        function gerarJogosInteligentes(duplas) {
            let jogos = [];
            for (let i = 0; i < duplas.length; i++) {
                for (let j = i + 1; j < duplas.length; j++) {
                    jogos.push({ i, j, key: `jg_${i}_${j}` });
                }
            }
            jogos.sort(() => Math.random() - 0.5);
            const final = [];
            while(jogos.length > 0) {
                let idx = 0;
                if(final.length > 0) {
                    const ult = final[final.length-1];
                    idx = jogos.findIndex(p => p.i !== ult.i && p.i !== ult.j && p.j !== ult.i && p.j !== ult.j);
                    if(idx === -1) idx = 0;
                }
                final.push(jogos.splice(idx, 1)[0]);
            }
            return final;
        }

        document.getElementById('btn-iniciar').onclick = () => {
            if(!confirm("Isso apagar√° todo o progresso atual. Confirmar?")) return;
            const qtd = parseInt(selQtd.value);
            const duplas = [];
            for(let i=0; i<qtd; i++){
                const t = document.getElementById(`time-${i}`).value;
                duplas.push({ nome: document.getElementById(`nome-${i}`).value || `Guri ${i+1}`, timeID: timesFC25[t] });
            }
            const ordem = gerarJogosInteligentes(duplas);
            set(ref(db, 'campeonato/'), { duplas, placares: {}, ordemJogos: ordem });
            window.openTab('aba-grupo');
        };

        onValue(ref(db, 'campeonato/'), (snap) => {
            const data = snap.val();
            if(!data) return;
            localData = data;
            atualizarTudo();
        });

        function atualizarTudo() {
            const { duplas, placares = {}, ordemJogos = [] } = localData;
            const stats = {};
            duplas.forEach(d => stats[d.nome] = { pontos: 0, v: 0, gp: 0, gc: 0, sg: 0, j: 0, timeID: d.timeID });

            ordemJogos.forEach(jogo => {
                const p = placares[jogo.key];
                if(p && p.f) {
                    const n1 = duplas[jogo.i].nome, n2 = duplas[jogo.j].nome;
                    stats[n1].j++; stats[n2].j++;
                    stats[n1].gp += p.g1; stats[n1].gc += p.g2;
                    stats[n2].gp += p.g2; stats[n2].gc += p.g1;
                    if(p.g1 > p.g2) { stats[n1].pontos += 3; stats[n1].v++; }
                    else if(p.g2 > p.g1) { stats[n2].pontos += 3; stats[n2].v++; }
                    else { stats[n1].pontos++; stats[n2].pontos++; }
                    stats[n1].sg = stats[n1].gp - stats[n1].gc;
                    stats[n2].sg = stats[n2].gp - stats[n2].gc;
                }
            });

            const ordenados = Object.keys(stats).map(n => ({ n, ...stats[n] })).sort((a,b) => b.pontos - a.pontos || b.sg - a.sg);
            document.getElementById('corpo-tabela').innerHTML = ordenados.map((t, i) => `
                <tr><td>${i+1}¬∫</td><td style="text-align:left; padding-left:10px;"><img class="logo-img" src="https://media.api-sports.io/football/teams/${t.timeID}.png"> ${t.n}</td>
                <td style="color:var(--gold); font-weight:bold">${t.pontos}</td><td>${t.j}</td><td>${t.v}</td><td>${t.sg}</td></tr>`).join('');

            document.getElementById('container-jogos').innerHTML = ordemJogos.map((jogo, idx) => {
                const p = placares[jogo.key] || { g1: 0, g2: 0, f: false };
                const t1 = duplas[jogo.i], t2 = duplas[jogo.j];
                return `<div class="jogo"><div style="font-size:0.6em; color:#666; margin-bottom:5px">JOGO ${idx+1}</div><div class="match-row"><div class="team-display flex-end">${t1.nome} <img class="logo-img" src="https://media.api-sports.io/football/teams/${t1.timeID}.png"></div><input type="number" class="score-input" value="${p.g1}" id="i1-${jogo.key}"> X <input type="number" class="score-input" value="${p.g2}" id="i2-${jogo.key}"><div class="team-display"><img class="logo-img" src="https://media.api-sports.io/football/teams/${t2.timeID}.png"> ${t2.nome}</div></div><button class="btn-ok" style="background:${p.f?'#1e2533':''}" onclick="window.salvarP('${jogo.key}')">${p.f?'ATUALIZAR':'SALVAR RESULTADO'}</button></div>`;
            }).join('');
            
            renderMataMata(ordenados);
        }

        window.salvarP = (key) => {
            const g1 = parseInt(document.getElementById(`i1-${key}`).value) || 0;
            const g2 = parseInt(document.getElementById(`i2-${key}`).value) || 0;
            update(ref(db, `campeonato/placares/${key}`), { g1, g2, f: true });
        };

        function renderMataMata(classificados) {
            const container = document.getElementById('mata-mata-container');
            const total = classificados.length;
            container.innerHTML = "";
            const fases = [];
            if (total > 16) fases.push({ nome: "Oitavas de Final", qtd: 8, prefix: "oitava" });
            if (total > 8) fases.push({ nome: "Quartas de Final", qtd: 4, prefix: "quarta" });
            fases.push({ nome: "Semifinais", qtd: 2, prefix: "semi" });
            fases.push({ nome: "Grande Final", qtd: 1, prefix: "final" });

            fases.forEach((fase, fIdx) => {
                container.innerHTML += `<div class="fase-titulo">${fase.nome}</div>`;
                for (let i = 0; i < fase.qtd; i++) {
                    const key = `${fase.prefix}_${i}`;
                    const p = localData.placares[key] || { t1: null, t2: null, g1: 0, g2: 0, f: false };
                    
                    // Preenchimento autom√°tico inicial
                    if (fIdx === 0 && !p.t1 && classificados.length >= fase.qtd * 2) {
                        p.t1 = { n: classificados[i].n, timeID: classificados[i].timeID };
                        p.t2 = { n: classificados[fase.qtd*2-1-i].n, timeID: classificados[fase.qtd*2-1-i].timeID };
                        update(ref(db, `campeonato/placares/${key}`), { t1: p.t1, t2: p.t2 });
                    }

                    container.innerHTML += `
                        <div class="jogo">
                            <div class="match-row">
                                <div class="team-display flex-end">${p.t1?p.t1.n:'?'}<img class="logo-mata" src="${p.t1?'https://media.api-sports.io/football/teams/'+p.t1.timeID+'.png':''}"></div>
                                <input type="number" class="score-input" id="g1-${key}" value="${p.g1}"> X <input type="number" class="score-input" id="g2-${key}" value="${p.g2}">
                                <div class="team-display"><img class="logo-mata" src="${p.t2?'https://media.api-sports.io/football/teams/'+p.t2.timeID+'.png':''}">${p.t2?p.t2.n:'?'}</div>
                            </div>
                            <button class="btn-ok" onclick="window.avancar('${key}', '${fases[fIdx+1]?.prefix || 'campeao'}', ${i})">${p.f?'ATUALIZAR':'AVAN√áAR'}</button>
                        </div>`;
                }
            });
        }

        window.avancar = (key, proxFase, index) => {
            const g1 = parseInt(document.getElementById(`g1-${key}`).value) || 0;
            const g2 = parseInt(document.getElementById(`g2-${key}`).value) || 0;
            if(g1 === g2) { alert("Empate n√£o permitido no Mata-Mata!"); return; }
            
            const matchData = localData.placares[key];
            if(!matchData || !matchData.t1 || !matchData.t2) { alert("Aguardando times!"); return; }
            
            const vencedor = g1 > g2 ? matchData.t1 : matchData.t2;
            const updates = {};
            updates[`campeonato/placares/${key}/g1`] = g1;
            updates[`campeonato/placares/${key}/g2`] = g2;
            updates[`campeonato/placares/${key}/f`] = true;

            if (proxFase === 'campeao') {
                update(ref(db), updates);
                push(ref(db, 'hall/'), { nome: vencedor.n, timeID: vencedor.timeID, data: new Date().toLocaleDateString() });
                document.getElementById('nome-campeao').innerText = vencedor.n;
                document.getElementById('img-vencedor').innerHTML = `<img src="https://media.api-sports.io/football/teams/${vencedor.timeID}.png" style="width:120px">`;
                window.openTab('aba-vencedor');
            } else {
                const proxIdx = Math.floor(index / 2);
                const pos = index % 2 === 0 ? 't1' : 't2';
                updates[`campeonato/placares/${proxFase}_${proxIdx}/${pos}`] = vencedor;
                update(ref(db), updates);
            }
        };

        onValue(ref(db, 'hall/'), (snap) => {
            const data = snap.val() || {};
            document.getElementById('lista-hall').innerHTML = "<h2 style='color:var(--gold); text-align:center;'>üéñÔ∏è GALERIA DE HONRA</h2>" + Object.values(data).reverse().map(h => `<div style="display:flex; align-items:center; justify-content:space-between; padding:12px; border-bottom:1px solid #333;"><img src="https://media.api-sports.io/football/teams/${h.timeID}.png" style="width:30px"><b>${h.nome}</b><small style="color:#888">${h.data}</small></div>`).join('');
        });
    </script>
</body>
</html>
